<ion-header mode="ios">
  <ion-toolbar [ngClass]="{'ion-toolbar-absolute': !utils.isMobile()}">
    <ion-buttons slot="start" *ngIf="utils.isMobile()">
      <ion-button (click)="back()" id="btn-back">
        <ion-icon class="icon-backward ion-margin-start" name="arrow-back" (click)="back()" color="primary" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="ion-text-center" [ngClass]="{
      'subtitle-2': !utils.isMobile()
    }">Topic</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding app-topic" color="light" [ngClass]="{'ion-content-absolute-with-footer': !utils.isMobile()}">
  <div class="ion-text-center ion-margin-top" *ngIf="loadingTopic">
    <ion-spinner></ion-spinner>
  </div>
  <h3 class="headline-4 ion-text-center">{{topic.title}}</h3>
  <div *ngIf="topic.videolink && topic.videolink !=='magiclink' && topic.videolink.indexOf('trailhead') == -1" class="text-center">
    <div [innerHtml]="iframeHtml" class="video-container ion-text-center" [ngClass]="{'desktop-view': !utils.isMobile()}"></div>
  </div>
  <div *ngIf="iframeHtml && topic.videolink && topic.videolink !=='magiclink' && topic.videolink.indexOf('trailhead') > 0">
      <div [innerHtml]="iframeHtml" id="trailheadInner" [ngClass]="{'desktop-view': !utils.isMobile()}"></div>
  </div>
  <div *ngIf="!iframeHtml && topic.videolink !=='magiclink' && topic.videolink.indexOf('trailhead') > 0">
      <div class="ion-text-center" style="margin-top: 20px;">
        Loading content from
         <img width=50 src="https://trailhead.salesforce.com/assets/trailhead-logo-86df2c10154e03fb8b18110597a115ecce58d8bb2887e33a155ae8784cca5784.svg"> 
      </div>
      <div class="ion-padding custom-skeleton">
        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
        <ion-skeleton-text animated></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 88%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 70%"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
      </div>
      <ion-list>
        <ion-list-header>
          <ion-label>
            <ion-skeleton-text animated style="width: 20%"></ion-skeleton-text>
          </ion-label>
        </ion-list-header>
        <ion-item>
          <ion-avatar slot="start">
            <ion-skeleton-text animated></ion-skeleton-text>
          </ion-avatar>
          <ion-label>
            <h3>
              <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
            </h3>
            <p>
              <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
            </p>
            <p>
              <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
            </p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-thumbnail slot="start">
            <ion-skeleton-text animated></ion-skeleton-text>
          </ion-thumbnail>
          <ion-label>
            <h3>
              <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
            </h3>
            <p>
              <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
            </p>
            <p>
              <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
            </p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-skeleton-text animated style="width: 27px; height: 27px" slot="start"></ion-skeleton-text>
          <ion-label>
            <h3>
              <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
            </h3>
            <p>
              <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
            </p>
            <p>
              <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
            </p>
          </ion-label>
        </ion-item>
      </ion-list>
  </div>   
 

  <ng-container *ngIf="topic.content  && topic.videolink.indexOf('trailhead') == -1">
    <ion-card class="background-white practera-card">
      <ion-card-content class="body-1 black" [innerHtml]="topic.content"></ion-card-content>
    </ion-card>
  </ng-container>

  <div *ngIf="topic.files && topic.files.length > 0"  color="light" >
    <label class="subtitle-2 gray-2">Supporting Downloads</label>

    <div *ngFor="let file of topic.files" class="supporting-files">
      <ion-card class="background-white practera-card">
        <ion-grid >
          <ion-row>
            <ion-col size="10" class="file-name-view">
              <p class="vertical-middle black"><ion-icon name="document" class="vertical-middle" color="primary"></ion-icon>&nbsp;{{file.name}} </p>
            </ion-col>
            <ion-col size="2">
              <ion-icon class="vertical-middle hover-pointer" *ngIf="file.url.length > 0" name="search" (click)="previewFile(file)" color="primary"></ion-icon>
              <a *ngIf="file.url.length > 0" [href]="file.url" download class="text-right" target="_blank">
                <ion-icon name="download-outline" class="float-right"></ion-icon>
              </a>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card>
    </div>
  </div>
</ion-content>

<ion-footer color="light" [ngClass]="{'ion-footer-absolute': !utils.isMobile()}">
  <ion-toolbar class="ion-text-center" style="height: 100%">
    <ion-spinner *ngIf="loadingMarkedDone || loadingTopic"
      style="width: 100%;"
      name="dots"
      class="vertical-middle text-center"
    ></ion-spinner>

    <img *ngIf="redirecting" class="footer-action" src="/assets/loading.gif">

    <ion-button *ngIf="!loadingMarkedDone && !loadingTopic && !redirecting"
      (click)="continue()"
      shape="round"
      fill="clear">
      <ion-icon *ngIf="btnToggleTopicIsDone" color="primary" slot="start" name="checkmark"></ion-icon>
      <ion-text>CONTINUE</ion-text>
    </ion-button>
  </ion-toolbar>
</ion-footer>
